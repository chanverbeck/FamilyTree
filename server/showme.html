<html>
<head>
<title>Show me!</title>
<script type='text/javascript'>
function getPerson(index)
{
   var xmlHttp = new XMLHttpRequest();
   xmlHttp.open ('GET', '/person/' + index, false);
  // xmlHttp.open ('GET', '/bla', false);
   xmlHttp.send (null);
   return xmlHttp.responseText;
}

function getText()
{
  var inputField = document.getElementById('number');
  // alert('value: ' + inputField.value);
  
  var numberToQuery = parseInt(inputField.value, 10);
  // alert('converted value: ' + numberToQuery.toString());
  var divToFill = document.getElementById('divtofill');

  if (numberToQuery && numberToQuery !== NaN) {
    var childIndex;
    var familyIndex;
    var family;
    var queriedText = getPerson(numberToQuery);
    var personData = JSON.parse(queriedText);
    var html = '';
    html += '<p>(' + personData.person.pid + ') ' + personData.person.name;
    if (personData.person.birthdate || personData.person.birthplace) {
      html += '<br>Born ' + (personData.person.birthdate? (personData.person.birthdate + ' '): '') + (personData.person.birthplace? personData.person.birthplace: '');
    }
    if (personData.person.deathdate || personData.person.deathplace) {
      html += '<br>Died ' + personData.person.deathdate + ' ' + personData.person.deathplace;
      html += '<br>Died ' + (personData.person.deathdate? (personData.person.deathdate + ' '): '') + (personData.person.deathplace? personData.person.deathplace: '');
    }
    if (personData.father) {
      html += '<p>Father: (' + personData.father.pid + ') ' + personData.father.name;
    }
    if (personData.mother) {
      html += '<p>Mother: (' + personData.mother.pid + ') ' + personData.mother.name;
    }
    if (personData.families) {
      for (familyIndex = 0; familyIndex < personData.families.length; ++familyIndex) {
        family = personData.families[familyIndex];
        if (family.spouse) {
          html += '<p>Married to (' + family.spouse.pid + ') ' + family.spouse.name;
        }
        if (family.children && family.children.length > 0) {
          html += '<p>Children:';
          for (childIndex = 0; childIndex < family.children.length; ++childIndex) {
            html += '<p>(' + family.children[childIndex].pid + ') ' + family.children[childIndex].name;
          }
        }
      }
    }
    divToFill.innerHTML = html; // + '<p>' + queriedText;
  } else {
    // alert('bad number ' + numberToQuery);
    divToFill.innerHTML = '<p>Value ' + inputField.value + ' must be a number.';
  } 
}
</script>
</head>
<body onload='getText();'>
<p>Show me!
<input id='number'/>
<button onclick="getText();">Go</button>
<div id='divtofill'></div>
</body>
</html>
